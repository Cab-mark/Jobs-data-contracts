openapi: 3.0.3
info:
  title: Jobs Search API
  version: "1.10.0"
  description: >
    API for searching jobs. This specification exposes:
    - GET /jobs for simple, linkable searches via query parameters
    - POST /jobs/search for complex searches in the request body (avoids URL length limits)

    Geospatial behavior defaults to filtering when a radius is provided; use sort=distance:asc (or :desc) to sort by distance.
servers:
  - url: https://search-api.example.com
    description: Production search server
paths:
  /jobs:
    get:
      summary: Search jobs (supports geospatial and facet filtering)
      operationId: searchJobs
      parameters:
        - name: q
          in: query
          description: Full-text query string
          schema:
            type: string
        - name: page
          in: query
          description: Page number (1-based)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          description: Page size
          schema:
            type: integer
            minimum: 1
            default: 10
        - name: sort
          in: query
          description: >
            Sort order (e.g. relevance, closingDate:asc, distance:asc). When a radius is provided,
            you may sort by distance using distance:asc or distance:desc.
          schema:
            type: string
            example: "distance:asc"

        # Geospatial parameters: point-radius filter (defaults to filtering)
        - name: latitude
          in: query
          description: Latitude for geospatial filtering (WGS84). Required with longitude when radius is provided.
          schema:
            type: number
            format: double
            minimum: -90
            maximum: 90
        - name: longitude
          in: query
          description: Longitude for geospatial filtering (WGS84). Required with latitude when radius is provided.
          schema:
            type: number
            format: double
            minimum: -180
            maximum: 180
        - name: radius
          in: query
          description: >
            Radius value used for geospatial point-radius filtering, interpreted using distanceUnit (km or mi).
            Results are filtered to jobs within this radius from (latitude, longitude).
          schema:
            type: number
            format: double
            minimum: 0
        - name: distanceUnit
          in: query
          description: Unit for geospatial radius and distance sorting.
          schema:
            type: string
            enum: [km, mi]
            default: km

        # Organisation filter
        - name: organisation
          in: query
          description: Filter by organisation (exact or implementation-defined match).
          schema:
            type: string

        # Profession filter (multi-select)
        - name: professions
          in: query
          description: One or more professions to filter by.
          style: form
          explode: true
          schema:
            type: array
            items:
              $ref: '#/components/schemas/Profession'

        # Grade filter (multi-select)
        - name: grades
          in: query
          description: One or more grades to filter by.
          style: form
          explode: true
          schema:
            type: array
            items:
              $ref: '#/components/schemas/Grade'

        # Assignments filter (multi-select)
        - name: assignments
          in: query
          description: One or more assignment types to filter by.
          style: form
          explode: true
          schema:
            type: array
            items:
              $ref: '#/components/schemas/Assignments'

        # Working pattern filter (multi-select)
        - name: workingPatterns
          in: query
          description: One or more working patterns to filter by.
          style: form
          explode: true
          schema:
            type: array
            items:
              $ref: '#/components/schemas/WorkingPattern'

        # Work location (aka "work office/home") filter (multi-select)
        - name: workLocations
          in: query
          description: One or more work locations to filter by (Home based, Office based).
          style: form
          explode: true
          schema:
            type: array
            items:
              $ref: '#/components/schemas/WorkLocation'

        # Salary filters
        - name: salaryMin
          in: query
          description: Minimum salary filter (numeric). Implementation assumes GBP currency.
          schema:
            type: number
            format: double
            minimum: 0
        - name: salaryMax
          in: query
          description: Maximum salary filter (numeric). Implementation assumes GBP currency.
          schema:
            type: number
            format: double
            minimum: 0

      responses:
        "200":
          description: Search results aligned with JobSearchResponse
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobSearchResponse'
        "400":
          description: Invalid query
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /jobs/search:
    post:
      summary: Search jobs using a request body (use for complex filters or long queries)
      operationId: searchJobsPost
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobSearchRequest'
            examples:
              distanceSortExample:
                value:
                  q: "engineer"
                  page: 1
                  pageSize: 20
                  sort: "distance:asc"
                  latitude: 51.5074
                  longitude: -0.1278
                  radius: 25
                  distanceUnit: "mi"
                  professions: ["Digital and Data"]
                  grades: ["Higher Executive Officer (HEO)"]
                  assignments: ["Permanent"]
                  workingPatterns: ["Full-time"]
                  workLocations: ["Office based"]
                  organisation: "HMRC"
                  salaryMin: 30000
      responses:
        "200":
          description: Search results aligned with JobSearchResponse
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobSearchResponse'
        "400":
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    # Request body schema for POST /jobs/search (mirrors GET query params)
    JobSearchRequest:
      type: object
      properties:
        q:
          type: string
        page:
          type: integer
          minimum: 1
          default: 1
        pageSize:
          type: integer
          minimum: 1
          default: 10
        sort:
          type: string
          description: Sort order (e.g. relevance, closingDate:asc, distance:asc).
          example: "distance:asc"
        latitude:
          type: number
          format: double
          minimum: -90
          maximum: 90
        longitude:
          type: number
          format: double
          minimum: -180
          maximum: 180
        radius:
          type: number
          format: double
          minimum: 0
          description: >
            Radius value used for geospatial point-radius filtering, interpreted using distanceUnit (km or mi).
        distanceUnit:
          type: string
          enum: [km, mi]
          default: km
        organisation:
          type: string
        professions:
          type: array
          items:
            $ref: '#/components/schemas/Profession'
        grades:
          type: array
          items:
            $ref: '#/components/schemas/Grade'
        assignments:
          type: array
          items:
            $ref: '#/components/schemas/Assignments'
        workingPatterns:
          type: array
          items:
            $ref: '#/components/schemas/WorkingPattern'
        workLocations:
          type: array
          items:
            $ref: '#/components/schemas/WorkLocation'
        salaryMin:
          type: number
          format: double
          minimum: 0
          description: Minimum salary filter (numeric). Implementation assumes GBP currency.
        salaryMax:
          type: number
          format: double
          minimum: 0
          description: Maximum salary filter (numeric). Implementation assumes GBP currency.

    # Result item aligned to the provided JobResultItem interface.
    JobResultItem:
      type: object
      required:
        - id
        - externalId
        - title
        - organisation
        - location
        - workingPattern
        - assignmentType
        - salary
        - workLocation
        - grade
        - closingDate
        - profession
        - approach
      properties:
        id:
          type: string
          description: Internal unique identifier
          readOnly: true
        externalId:
          type: string
          description: External identifier (canonical job id)
          readOnly: true
        title:
          type: string
        organisation:
          type: string
        location:
          oneOf:
            - type: array
              items:
                $ref: '#/components/schemas/FixedLocation'
            - type: array
              items:
                $ref: '#/components/schemas/OverseasLocation'
          description: Array of fixed locations OR array of overseas locations
        workingPattern:
          type: array
          items:
            $ref: '#/components/schemas/WorkingPattern'
          description: Working pattern(s) for the job
        assignmentType:
          $ref: '#/components/schemas/Assignments'
        salary:
          $ref: '#/components/schemas/Salary'
        workLocation:
          type: array
          description: Work location(s) for the job (Home based, Office based)
          items:
            $ref: '#/components/schemas/WorkLocation'
        grade:
          description: Grade can be from the defined enum or a free-form string
          oneOf:
            - $ref: '#/components/schemas/Grade'
            - type: string
        closingDate:
          type: string
          format: date
          description: Closing date (ISO-8601 date). Date-only format; time component is not accepted.
        profession:
          $ref: '#/components/schemas/Profession'
        approach:
          $ref: '#/components/schemas/Approach'

    JobSearchResponse:
      type: object
      required:
        - results
        - total
        - page
        - pageSize
        - totalPages
        - query
        - appliedFilters
      properties:
        results:
          type: array
          description: List of job result items
          items:
            $ref: '#/components/schemas/JobResultItem'
        total:
          type: integer
        page:
          type: integer
        pageSize:
          type: integer
        totalPages:
          type: integer
        query:
          type: string
          nullable: true
        appliedFilters:
          type: string
          nullable: true

    FixedLocation:
      type: object
      required:
        - townName
        - region
        - latitude
        - longitude
      properties:
        uprn:
          type: string
          description: Unique Property Reference Number
        paoText:
          type: string
          description: Primary Addressable Object text
        saoText:
          type: string
          description: Secondary Addressable Object text
        streetDescription:
          type: string
          description: Street description
        townName:
          type: string
        region:
          type: string
        postcode:
          type: string
        latitude:
          type: number
          format: double
        longitude:
          type: number
          format: double

    OverseasLocation:
      type: object
      required:
        - countryName
        - countryCode
      properties:
        countryName:
          type: string
        countryCode:
          type: string
        locationDisplay:
          type: string

    Salary:
      type: object
      required:
        - minimum
        - currency
      properties:
        minimum:
          type: number
          format: double
        maximum:
          type: number
          format: double
        currency:
          type: string
        currencySymbol:
          type: string
        salaryDetails:
          type: string

    WorkingPattern:
      type: string
      enum:
        - Full-time
        - Part-time

    WorkLocation:
      type: string
      enum:
        - Home based
        - Office based

    Approach:
      type: string
      enum:
        - Internal
        - Across Government
        - External

    Assignments:
      type: string
      enum:
        - Apprentice
        - Fixed Term Appointment (FTA)
        - Loan
        - Secondment
        - Permanent

    Grade:
      type: string
      enum:
        - Senior Civil Service - Permanent Secretary
        - Senior Civil Service - Director General (PB3)
        - Senior Civil Service - Director (PB2)
        - Senior Civil Service - Deputy Director (PB1/1A)
        - Grade 6
        - Grade 7
        - Senior Executive Officer (SEO)
        - Higher Executive Officer (HEO)
        - Executive Officer (EO)
        - Administrative Officer (AO)
        - Administrative Assistant (AA)

    Profession:
      type: string
      enum:
        - Actuary
        - Commercial
        - Communications
        - Corporate Finance
        - Counter Fraud
        - Digital and Data
        - Economics
        - Finance
        - Geography
        - Human Resources
        - Intelligence Analysis
        - Internal Audit
        - International Trade
        - Knowledge and Information Management
        - Legal
        - Clinical
        - Occupational Psychology
        - Operational Delivery
        - Operational Research
        - Planning
        - Planning Inspection
        - Policy
        - Project Delivery
        - Property
        - Risk Management
        - Science and Engineering
        - Security
        - Social Research
        - Statistics
        - Tax
        - Veterinary

    Error:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
      example:
        code: 400
        message: "Invalid request"